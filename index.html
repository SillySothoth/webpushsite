<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebPush Test</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <script src="scripts/utils.js"></script>
    <script src="scripts/encryptionService.js"></script>
    <script src="scripts/pushDataLoader.js"></script>
    <script src="scripts/pushSubscription.js"></script>
    <script src="scripts/uiManager.js"></script>

    <div class="container">
        <h1>WebPush Тестирование</h1>

        <div class="input-group">
            <label for="publicKey">VAPID Public Key:</label>
            <input type="text" id="publicKey" placeholder="Введите ваш VAPID публичный ключ">
        </div>

        <button id="subscribeBtn">Подписаться на уведомления</button>

        <div id="status"></div>

        <div id="subscriptionData">
            <h3>Данные подписки:</h3>
            <div class="data-item">
                <div class="data-label">Endpoint:</div>
                <div class="data-value" id="endpoint"></div>
            </div>
            <div class="data-item">
                <div class="data-label">P256DH Key:</div>
                <div class="data-value" id="p256dh"></div>
            </div>
            <div class="data-item">
                <div class="data-label">Auth Key:</div>
                <div class="data-value" id="auth"></div>
            </div>
            <div class="data-item">
                <div class="data-label">Ключ шифрования:</div>
                <div class="data-value" id="encryptionKey"></div>
            </div>
        </div>

        <div id="json-output"></div>
    </div>

    <script>
        // Загружаем данные при загрузке страницы
        document.addEventListener('DOMContentLoaded', function () {
            pushDataLoader.loadPushData();

            uiManager.initEventListeners();

            // Загружаем ключ шифрования
            encryptionService.loadEncryptionKey().then(key => {
                if (key) {
                    console.log('Ключ шифрования загружен из localStorage');
                }
            });

            //// Авторегистрация Service Worker
            //if ('serviceWorker' in navigator) {
            //    navigator.serviceWorker.register('./scripts/sw.js')
            //        .then(reg => console.log('SW готов'))
            //        .catch(err => console.error('Ошибка SW:', err));
            //}

            // Обработчик сообщений от Service Worker
            navigator.serviceWorker.addEventListener('message', function (event) {
                if (event.data && event.data.type === 'PUSH_DATA') {
                    pushDataLoader.displayJsonData(event.data.data);
                }
            });
        });
    </script>
</body>
</html>